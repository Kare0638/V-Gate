# V-Gate Configuration / V-Gate 配置文件
#
# Configuration priority (high to low):
# 1. Environment variables (e.g., VGATE_MODEL__MODEL_ID)
# 2. This YAML file
# 3. Default values in code
#
# Environment variable format: VGATE_<SECTION>__<KEY>
# Example: VGATE_BATCH__MAX_BATCH_SIZE=16

version: "0.3.2"

# Server settings / 服务器设置
server:
  host: "0.0.0.0"
  port: 8000

# Model configuration / 模型配置
model:
  model_id: "Qwen/Qwen2.5-1.5B-Instruct-AWQ"
  quantization: "awq"
  gpu_memory_utilization: 0.7
  max_model_len: 2048
  trust_remote_code: true
  enforce_eager: true

# Request batching / 请求批处理
batch:
  max_batch_size: 8
  max_wait_time_ms: 50.0

# Result cache / 结果缓存
cache:
  enabled: true
  maxsize: 1000

# Default inference parameters / 默认推理参数
inference:
  temperature: 0.7
  top_p: 0.9
  max_tokens: 256

# Logging configuration / 日志配置
logging:
  level: "INFO"
  json_format: true

# Prometheus metrics / Prometheus 指标
metrics:
  enabled: true

# Distributed Tracing (OpenTelemetry) / 分布式追踪 (OpenTelemetry)
tracing:
  enabled: false              # Enable OpenTelemetry tracing / 启用 OpenTelemetry 追踪
  service_name: "vgate"       # Service name in traces / 追踪中的服务名称
  otlp_endpoint: "http://localhost:4317"  # OTLP gRPC endpoint / OTLP gRPC 端点
  otlp_insecure: true         # Use insecure connection / 使用非加密连接
  sample_rate: 1.0            # Sampling rate (0.0-1.0) / 采样率
  log_correlation: true       # Inject trace_id into logs / 将 trace_id 注入日志

# Security & Access Control / 安全与访问控制
security:
  enabled: false  # Set to true in production / 生产环境设为 true

  # API Keys / API 密钥
  # Format: Authorization: Bearer <key>
  api_keys:
    - key: "sk-vgate-dev-example"
      name: "development"
      rate_limit: 1000  # requests per minute
    # Add more keys as needed / 按需添加更多密钥
    # - key: "sk-vgate-prod-xxxxx"
    #   name: "production"
    #   rate_limit: 100

  # Rate Limiting / 速率限制
  rate_limiting:
    enabled: true
    default_limit: 60    # requests per minute for unknown keys / 未知密钥的默认限制
    window_seconds: 60   # sliding window size / 滑动窗口大小

  # Paths exempt from authentication / 免认证路径
  exempt_paths:
    - "/health"
    - "/metrics"
